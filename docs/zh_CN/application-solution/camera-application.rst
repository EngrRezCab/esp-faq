摄像头应用方案
==============

:link_to_translation:`en:[English]`

.. raw:: html

   <style>
   body {counter-reset: h2}
     h2 {counter-reset: h3}
     h2:before {counter-increment: h2; content: counter(h2) ". "}
     h3:before {counter-increment: h3; content: counter(h2) "." counter(h3) ". "}
     h2.nocount:before, h3.nocount:before, { content: ""; counter-increment: none }
   </style>

--------------

ESP32 系列芯片支持哪种类型的摄像头？
--------------------------------------

  - 请参考 `ESP32 系列支持的摄像头型号 <https://github.com/espressif/esp32-camera/blob/master/README.md>`_。

--------------

摄像头输出图像都有什么格式？
------------------------------

  - 图像格式主要由摄像头决定，如果某个摄像头支持多个图像格式，如 RGB565、RGB888、YUV422、JPEG 等，需要通过配置摄像头的寄存器来选择输出格式。

--------------

摄像头支持哪些参数调整？
-------------------------

  - 图像数据传输速度 (PCLK)、摄像头输出格式、分辨率、输出图像大小、白平衡、GAMMA 校正等摄像头自带的图像模式参数调整。

--------------

摄像头中 MCLK 和 PCLK 的区别及关系？
--------------------------------------------

  - MCLK 是摄像头输入的主时钟，带动整个摄像头的主频。
  - PCLK 是摄像头输出的时钟，主要为输出数据提供 CLK。
  - MCLK 在摄像头内经过倍频/分频（根据摄像头配置决定）后得到 PCLK。

--------------

摄像头的 PCLK 是不是越高越好？
------------------------------

  - 理论上，PCLK 速度越高，数据传输越快，但实际使用中，PCLK 越高也意味着对芯片的处理速度要求越高。
  - 当前 ESP32 和 ESP32S2 芯片并口通信是通过 I2S 接口实现的，过高的 PCLK 会导致并口数据无法同步，出现图像抖动甚至花屏的现象。
  - ESP32S3 使用独立的 LCD—CAM 接口，可以支持更高的 PCLK 频率。

   - ESP32 的 PCLK 上限为 8 MHz。
   - ESP32S2 的 PCLK 上限为 32 MHz。
   - ESP32S3 的 PCLK 上限为 40 MHz。

--------------

ESP32 系列芯片支持 MIPI 接口吗？
--------------------------------

  - ESP32、ESP32S2 和 ESP32S3 均不支持，后续的芯片会支持。
  - 当前 ESP32 系列的芯片支持的摄像头接口有 DVP、SPI、USB。

--------------

ESP32 系列芯片支持 USB2.0 接口吗？
----------------------------------

  - ESP32 和 ESP32S2 均不支持，后续的芯片会支持。

--------------

摄像头中 YUV/RGB 的传输速度为何会比 JPEG 慢？
---------------------------------------------

  - 因为 YUV/RGB 数据量比 JPEG 的数据量大。
  - 例如：对于 320 × 240 的屏幕尺寸，YUV422 的输出为 153.6 K，而 JPEG 压缩后仅需约 10 K。

--------------

摄像头应用中，有哪些影响帧率的因素？
--------------------------------------

  - 帧率是指两张图片间刷新的速度，其影响因素主要为：

   - 摄像头性能及参数配置而产生的图像大小（输出图像分辨率大小、输出图像格式）。
   - CPU 处理速度（接收图像处理、图像转码速度、图传到网络或显示屏的速度）。

--------------

摄像头运行失败如何排查？
------------------------

  - 无法识别摄像头型号：

   - 检查管脚是否对应正确，重点关注 XCLK、SIOC、SIOD。
   - XCLK 输入的时钟频率太低或摄像头供电不正常，导致摄像头无法正常运行。
   - SIOC 和 SIOD 上挂载太多设备，导致轮询读到率先返回的地址 ID 不是摄像头而是其他设备。此情况建议固定摄像头 ID，以去除轮询步骤。

  - 摄像头识别到了型号，没有图像显示:

   - 检查摄像头数据管脚是否有信号，MCLK 是否正常输入。
   - 摄像头寄存器参数配置正确。

  - 摄像头图像显示不正常:

   - 检查代码，查看输出格式是 RGB、YUV 还是 JPEG，是否符合接收端需要的格式。
   - 尝试降低 PCLK 频率。

--------------

ESP32 支持传输视频流吗？
--------------------------------

  - 视频流的传输操作分为二进制传输和视频流编解码。

   - 二进制传输：ESP32 支持二进制传输，此处是否支持取决于传输的网络带宽。目前 ESP32 TCP 的带宽为 20 MB/s，请参考 `WiFI 测试数据 <https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-guides/wifi.html#id52>`_。
   - 视频流编解码：目前视频流主要格式有 H264、H265、MJPEG 等，ESP32 暂无视频流编解码操作的能力。

--------------

ESP-EYE 的出厂固件在哪里？
------------------------------------------------------------------------

  - 请参考 `ESP-EYE 的出厂固件 <https://github.com/espressif/esp-who/tree/master/default_bin>`_。

--------------

Camera 方案相关的示例存放在哪里？
------------------------------------------------------------------------

  - 请参考 `ESP-WHO <https://github.com/espressif/esp-who>`_。
  - 请参考 `esp-iot-solution <https://github.com/espressif/esp-iot-solution/tree/master/examples/camera>`_。
  - 请参考 `esp-dev-kits <https://github.com/espressif/esp-dev-kits>`_。

--------------

ESP32 支持 12 位 DVP 接口的摄像头吗？
-----------------------------------------------------------------

  不支持，目前驱动只支持 8 位的 DVP 接口。

-----------------

ESP32 是否支持使用不带 JEPG 编码的摄像头来获取 JPEG 图像？
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

  - 如果摄像头本身不支持 JPEG 编码，可以参考我们提供的 `esp-iot-solution/examples/camera/pic_server <https://github.com/espressif/esp-iot-solution/tree/master/examples/camera/pic_server>`_ 例程，在 ESP32 设备上实现软件 JPEG 编码。该方法通过软件对 YUV422 或 RGB565 数据进行编码，得到 JPEG 图像。

--------------

ESP-EYE 上的 200 万像素的 OV2640 摄像头是否可以改成只输出 30 万像素的图片？
------------------------------------------------------------------------------------------------------------------

  可以, 在初始化时通过配置 `frame_size <https://github.com/espressif/esp32-camera/blob/master/driver/include/sensor.h#L110>`_ 的值来指定摄像头要输出的分辨率大小。

--------------

ESP32 支持全局快门的摄像头吗？
-----------------------------------------------------------------

  支持，目前支持的摄像头型号为 SC031GS、SC132GS，其他摄像头需要额外增加驱动支持。

--------------

ESP32 使用 DVP 摄像头通过 RTSP 传输 1080P 的视频可以达到多少帧？
------------------------------------------------------------------------------------------------------------------

  暂未测试 1080P 的情况。目前 720P 可以达到 20 FPS.

--------------

ESP32-S3 只支持 MJPEG 编码，但在实现 rtsp/rtmp 推流的时候需要支持 H264/H265 格式的编码，请问是否有支持 H264/H265 格式的编码？
----------------------------------------------------------------------------------------------------------------------------------------------------------------

  暂无支持 H264/H265 格式的编码。

--------------

ESP32/ESP32-S3 是否有适配支持广角的摄像头？
-----------------------------------------------------------------

  有适配，可以参考 BF3005、OV5640 这两款摄像头。

--------------

ESP32-S2 从上电到显示摄像头图像需要 5 秒，是否有改善的空间？
-----------------------------------------------------------------

  有改善的空间，参考如下：

  - 尝试去掉 `esp_camera_init() <https://github.com/espressif/esp32-camera/blob/master/examples/main/take_picture.c#L133>` 里的一些延时函数。
  - 更改 `menuconfig` -> `component config` -> `camera configuration` 里的 sccb 的时钟频率为 400000。

--------------

ESP32 可以直接给 GC0308 摄像头提供 24 MHz 频率吗？
------------------------------------------------------------------------

  恐怕不行。经测试，ESP32 提供给 GC0308 的 XCLK 最大的稳定测试值为 20 MHz。

--------------

ESP32/ESP32-S3 是否支持 MMS 串流协议？
-----------------------------------------------------------------

  暂时不支持，但可以支持 SIP 和 RTSP。

--------------

使用 ESP32-S3 调试 GC2145 摄像头时，发现支持的最大分辨率为 1024x768，若是调至更大的分辨率，如 1280x720，会提示 cam_hal: EV-EOF-OVF 错误，有什么解决方法？
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

  这种情况下，需要降低 GC2145 的 PCLK。可以尝试配置更小的 XCLK，以及调试该摄像头的 PLL 时钟系数。

--------------

ESP32-S3 是否支持 GB28181 协议？
----------------------------------------------------------------------------

  目前还不支持。

--------------

ESP32/ESP32-S2/ESP32-S3 是否有通过摄像头识别二维码的参考？
----------------------------------------------------------------------------

  有，可以参考 ESP-WHO 里的 `code recognition <https://github.com/espressif/esp-who/tree/master/examples/code_recognition>`_。

--------------

想为 OV5640 传感器添加 SD 卡接口和摄像头接口，但发现 ESP32 中不同外设的一些管脚存在冲突，请提供摄像头接口和 SD 卡接口的管脚。
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

  `ESP-WROVER-KIT 开发板 <https://docs.espressif.com/projects/esp-idf/en/latest/esp32/hw-reference/esp32/get-started-wrover-kit-v3.html>`__ 中有 Camera 和 SD 卡电路，可以参考 `ESP-WROVER-KIT V3 入门指南的管脚配置 <https://docs.espressif.com/projects/esp-idf/en/latest/esp32/hw-reference/esp32/get-started-wrover-kit-v3.html>`__。
