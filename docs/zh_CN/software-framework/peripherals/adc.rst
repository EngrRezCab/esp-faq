模拟数字转换器 (ADC)
=======================

:link_to_translation:`en:[English]`

.. raw:: html

   <style>
   body {counter-reset: h2}
     h2 {counter-reset: h3}
     h2:before {counter-increment: h2; content: counter(h2) ". "}
     h3:before {counter-increment: h3; content: counter(h2) "." counter(h3) ". "}
     h2.nocount:before, h3.nocount:before, { content: ""; counter-increment: none }
   </style>

--------------

ESP8266 ADC 的精度如何？
------------------------------------------------

  - ESP8266 ADC 为 10 位，理论精度为 2 :sup:`10` = 1024。
  - ESP8266 连接路由器后，单 STA 模式会进⼊ Modem-sleep 模式，导致芯⽚内部参考值变化，因此 ADC 测量得数据变化。
  - 如果想要测量精确，可以在关闭 Wi-Fi 后，使用 ``system_adc_fast_read`` 函数读取。

--------------

ESP8266 如何获取 ADC 寄存器位图信息？
---------------------------------------------------------

  由于 ESP8266 ADC 是和内部 RF 电路⾼度集成的，所以位图和寄存器信息没有公开，如有特殊需求请联系 sales@espressif.com。

--------------

ESP32 ADC 有⼏个通道？采样率和有效位数是多少？
---------------------------------------------------------

  - ESP32 的 ADC 共有 18 个通道。
  - 在停⽌ Wi-Fi 的情况下，采样率能达到每秒 100000 次。
  - 在 Wi-Fi 正常⼯作的情况下，能达到每秒 1000 次。
  - ADC 内部有效位数为 12 位。

--------------

使用 ESP8266 调用 ``adc_read_fast()`` API 会导致 Wi-Fi 断连吗？
---------------------------------------------------------------------------------

  - 调用 ``adc_read_fast()`` API 前需要将 Wi-Fi 和中断关闭，可参见此 API 的 `使用说明 <https://docs.espressif.com/projects/esp8266-rtos-sdk/en/latest/api-reference/peripherals/adc.html?highlight=adc_read#_CPPv413adc_read_fastP8uint16_t8uint16_t>`_。
  - 由于 ``adc_read_fast()`` API 会进行连续采集，ADC 内部与 Wi-Fi RF 存在耦合部分，无法在 Wi-Fi 开启的状态下调用该函数。
  - 在 Wi-Fi 开启的时候请使用 ``adc_read()`` API 进行 ADC 采集。为保证数据稳定，需要使用 ``esp_wifi_set_ps(WIFI_PS_NONE)`` 函数关闭 Wi-Fi Modem-sleep 休眠模式。
 
.. note::

    ADC 采样率：在停⽌ Wi-Fi 的情况下，能达到每秒 100000 次。Wi-Fi 正常⼯作的情况下，能达到每秒 1000 次。

----------------

悬空 ADC 引脚，打印出 VDD3P3 的值为 65535，那么 VDD3P3 的电压就是 65535/1024 ≈ 63 V。这个电压值不符，是什么原因？
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

  ADC 输入范围不能到 3.3 V，可参考 `ADC Attenuation <https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-reference/peripherals/adc.html#adc-attenuation>`__。

----------------

ESP32 ADC 的输入电阻是多少？
---------------------------------------------------------

  ADC 是电容性的，可以认为电阻很大。

----------------

使用 ESP32 的 ADC 来检测电源电压，是否需要进行分压？
-------------------------------------------------------------------------------------

  ESP32 的 ADC 参考电压为 1100 mV，但可通过内部衰减来增大 ADC 量程，量程范围可参考 `ADC Attenuation <https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-reference/peripherals/adc.html#adc-attenuation>`__，超出范围则需要分压。

--------------

ESP32 芯片 ADC DMA 模式最高支持多大的采样频率？
-------------------------------------------------------------------------------------------------------------------------------------------

  理论最高支持 2 MHz 的采样频率。
  
---------------------

使用 ESP32，在 ``esp_wifi_start()`` 和 ``esp_wifi_stop()`` 之间读取 ``adc2_get_raw()`` 操作失败，是什么原因？
----------------------------------------------------------------------------------------------------------------------------------------------

  由于 ADC2 与 Wi-Fi 模块共享， Wi-Fi 驱动程序使用 ADC2，且 Wi-Fi 模块具有更高的优先级。因此，该应用程序只能在未启动 Wi-Fi 驱动程序时使用 ADC2。

---------------

ESP32 是否支持 ADC2 与蓝牙同时使用？
---------------------------------------------------------

  支持。

------------------

ESP32-S2 芯片 ADC DMA 模式支持的采样率范围是多大？
-----------------------------------------------------------------------------------------------------------------

  频率限制：611 Hz ~ 83333 Hz。

----------------------

ESP32 的 ADC 支持多通道同时采样吗？
----------------------------------------------------------------------------------------------------------------------

  ESP32 的 ADC 不支持多通道同时采样，若使用 ADC 多通道采样，需采取轮询采样的方式来实现。

----------------

使用 ESP32-WROVER-B 模组，ESP-IDF 为 release/v4.2 版本，当 GPIO 设置为 ADC 接口后，在不进行硬件重启的情况下，再将 GPIO 设置为其他 IO 模式且其他 IO 模式不生效后，此 GPIO 无反应，请问如何释放对应的 GPIO 模式？
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

  - 请不要将 ADC 接口设置为只输入的 GPIO。
  - 结束 ADC 接口模式时，请使用 ``adc_digi_stop()`` 关闭 ADC。

-------------

ESP32 芯片的 ADC 之间的测量误差是多大？
----------------------------------------------------------------------------------------------

  默认情况下，ESP32 芯片 ADC 之间的测量差异是 ±6%，可参考 `《ESP32 技术规格书》 <https://www.espressif.com/sites/default/files/documentation/esp32_datasheet_cn.pdf>`_。

-------------

ESP32 能同时用两个 ADC 通道来测量不同的数据吗？比如电流和电压？
-----------------------------------------------------------------------------------------------
   
  使用一个 ADC 无法做到同一时刻读取多个 ADC 通道的值，可以依次轮询读取两个 ADC 通道的数据。